# Generated vagrant file
#
# -*- mode: ruby -*-
# vi: set ft=ruby :

{# Macro that prints out attributes of a device #}
{% macro printAttributes(device_name) %}
{% for command in devices[device_name] %}
    {{ command }}
{% endfor %}
{% endmacro %}

{# Device definitions #}
Vagrant.configure("2") do |config|
{% for name, attributes in devices.items() %}

  # device: {{ name }}
  config.vm.define "{{ name }}" do |device|
{{ printAttributes(name) }}  end
{% endfor %}

  # basic ansible configuration of devices and networks
  config.vm.provision :ansible{% if ansible_local %}_local{% endif %} do |ansible|
    ansible.playbook = "base_provisioning/device_configuration.yml"
    ansible.verbose = true
    ansible.extra_vars = {
      ansible_python_interpreter: "/usr/bin/python3",
    }
  end


  # user configuration of devices with ansible
  config.vm.provision :ansible{% if ansible_local %}_local{% endif %} do |ansible|
    ansible.playbook = "provisioning/playbook.yml"
    ansible.verbose = true
    ansible.extra_vars = {
      ansible_python_interpreter: "/usr/bin/python3",
    }
  end

  {% for name in user_files %}
  config.vm.provision :ansible{% if ansible_local %}_local{% endif %} do |ansible|
    ansible.playbook = "provisioning/{{ name }}.yml"
    ansible.verbose = true
    ansible.extra_vars = {
      ansible_python_interpreter: "/usr/bin/python3",
    }
  end
  {% endfor %}

end
